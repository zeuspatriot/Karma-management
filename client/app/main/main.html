<div ng-include="'components/navbar/navbar.html'"></div>
<div class="container" >
	<div class="row" layout="row">
		<div flex="66" class="info-holder">
			<md-toolbar class="md-theme-light">
				<h2 class="md-toolbar-tools">
					<span>Karma Graph</span>
				</h2>
			</md-toolbar>
				<div class="whitebox padding-15 margin-bot-15 md-whiteframe-z1">
						<nvd3-multi-bar-chart
								ng-model="filteredChartData"
								objectequality="true"
								data="filteredChartData"
								id="exampleId"
								height="350"
								showXAxis="false"
								showYAxis="true"
								showLegend="true"
								showControls="false"
								reduceXTicks="false"
								rotateLabels="0"
								delay="1000"
								interactive="true"
								tooltips="true"
								clipEdge="true"
								staggerLabels="false"
								ng-if="filteredChartData[0]"
								noData="Sorry, no data is available at the moment :("
								>
									<svg></svg>
						</nvd3-multi-bar-chart>
					</div>

				 

					<!-- Middle section with user list -->
					<md-toolbar class="md-theme-light">
							<h2 class="md-toolbar-tools">
								<span>Filters</span>
							</h2>
						</md-toolbar>
					<div class="whitebox padding-15 margin-bot-15 md-whiteframe-z1" layout="column">
						<div flex>
							<div class="input-group">
							<!-- <p>Filter by team:</p> -->
							 <md-button class="md-raised slide"  ng-repeat="team in teams" ng-class="{'md-primary': filters.teams.indexOf(team)>-1}" ng-click="filtersChange(team,'team')">{{team}}</md-button>		
							<!-- </div> -->
							<!-- <div class="input-group"> -->
								<!-- <h4>Filter by Job Code:</h4> -->
								<md-button class="md-raised" ng-repeat="code in jobCodes" ng-click="filtersChange(code,'jobCode')" ng-class="{'md-primary': filters.jobCodes.indexOf(code)>-1}">{{code}}</md-button>
							</div>
						</div>

						<div flex>
						<!-- <h4>Or type user name:</h4> -->
							<md-input-container>
					      <label class="color-black">Or type search query here...</label>
					      <input ng-model="freeHandFilter">
					    </md-input-container>
							<!-- <input type="text" class="form-control" ng-model="freeHandFilter" placeholder="Type user name here..."> -->
						</div>
					</div>
					<section layout-wrap class="md-whiteframe-z1">
						<md-toolbar class="md-theme-light" layout="row">
							<h2 class="md-toolbar-tools">
								<span>Teammembers</span>
							</h2>
						</md-toolbar>
						<md-content>
							<md-list>
								<md-list-item class="md-3-line" ng-repeat="user in filteredUsers | orderBy:'name' | filter : freeHandFilter" layout="row" ng-class="{'list-group-item-info': isUserSelected(user.name), pointer : rules.checkboxes}" ng-click="seeProfile(user._id)">
									<div flex="25" class="md-list-item-text" layout="column">
										<h3 class="md-display-3 bold">{{user.name}}</h3>
										<h4 class="md-display-4">{{user.email}}</h4>
										<p>Karma: {{user.points}}</p>
									</div>
									<div flex="75" class="md-list-item-text" layout="column">
										<p class="color-black">{{user.recent.points}}pts for: {{user.recent.msg}}</p>
										<p ng-if="user.recent.note">Comment: {{user.recent.note}}</p>
										<p class="text-muted">{{user.recent.date}}<p>
										<p class="text-muted">by: {{user.recent.updatedBy}}</p>
									</div>
									<md-divider ng-if="!$last"></md-divider>
								</md-list-item>
							</md-list>
						</md-content>
					</section>
				


					
		</div>

<!-- Right section with Goals starts here -->

		<div flex="33" offset="5" class="">
			<section layout-wrap class="md-whiteframe-z1">
				<md-content>
				<md-toolbar class="md-theme-light" layout="row" layout-align="center center">
					<div flex>
						<h2 class="md-toolbar-tools">
							<span>Team goals</span>
						</h2>
					</div>
					<div flex-order="2" class="deleteBtn">
								<md-button class="md-fab md-mini md-primary deleteIcon" ng-click="newRuleFlag = true">
				          +
				        </md-button>
							</div>
				</md-toolbar>
					<md-list>
						<md-list-item class="md-3-line" ng-repeat='rule in rules.content | orderBy:"points":true' ng-click='ruleCollapse(rule);toggleRight()' layout="row" layout-align="start center">
								<h4 flex>{{rule.msg}}</h4>
								<div flex-odrer="2">
									<md-button  class="md-fab md-mini" ng-class="{'md-primary': rule.points >= 0, 'md-warn': rule.points < 0}">
										{{rule.points}}
									</md-button>
								</div>
							<md-divider ng-if="!$last"></md-divider>
						</md-list-item>
						<md-toolbar ng-if="newRuleFlag">
							<h2 class="md-toolbar-tools">
								<span>Create new goal</span>
							</h2>
						</md-toolbar>
							<md-list-item class="md-3-line padding-15" ng-if="newRuleFlag" flex layout="column">
								<div  layout="row">
									<md-input-container flex="75">
							    	<label class="color-black">Goal text</label>
							    	<input required name="text" ng-model="newRule.text">
							    </md-input-container>
							    <md-input-container flex="25">
							    	<label class="color-black">points</label>
							    	<input type="number" step="1" name="points" required ng-model="newRule.points">
							    </md-input-container>
								</div>
						    <div flex class="">
			      			<md-button class="md-raised md-primary" ng-disabled="!(newRule.text && newRule.points)" ng-click="addRule()">Create</md-button>
							    <md-button class="md-raised" ng-click="newRuleTogle()">Cancel</md-button>
								</div>
							</md-list-item>
					</md-list>
			<!-- Sidenav section with selecting users for certain goal fullfilment-->
			<md-sidenav class="md-sidenav-right md-whiteframe-z2 goals" md-component-id="right">
						<md-toolbar class="md-theme-light" layout="row" layout-align="center center">
							<div flex>
								<h1  class="md-toolbar-tools">Fullfill goal</h1>
							</div>
							<div flex-order="2" class="deleteBtn">
								<md-button class="md-fab md-mini md-primary deleteIcon" ng-click="showConfirm($event)">
				          <span class="glyphicon glyphicon-trash pointer"></span>
				        </md-button>
							</div>
						</md-toolbar>
						<md-content layout-padding flex-layout="column">
						<h4 flex>{{getActiveRule().points}} points for '{{getActiveRule().msg}}', will go to:</h4>

							<md-content class="md-padding autocomplete" layout="column">
							    <md-contact-chips
							    		collection="contacts"
							        ng-model="changeKarma"
							        md-search-text-change = ""
							        md-selected-item-change = ""
							        md-contacts="querySearch($query)"
							        md-contact-name="name"
							        md-contact-image="null"
							        md-contact-email="email"
							        md-require-match
							        filter-selected="filterSele"
							        placeholder="Type names here">
							    </md-contact-chips>
							    <md-list class="fixedRows">
							    </md-list>
							  </md-content>

					    <div flex>
					    	<md-input-container flex>
					        <label class="color-black">You may add comment here...</label>
					        <input ng-model="getActiveRule().note">
					      </md-input-container>
					    </div>
							<div flex class="sidenavBtn">
		      			<md-button class="md-raised md-primary sidenavBtn" ng-click="changeUserKarma(changeKarma, getActiveRule())">Confirm</md-button>
						    <md-button class="md-raised sidenavBtn" ng-click="clearTmp(); close()">Cancel</md-button>
							</div>
						</md-content>
					</md-sidenav>
				</md-content>
					

			</section>


			<!-- <div class="list-group sticky">
				<a class="list-group-item active"> Team goals </a>
				<a class="list-group-item" ng-hide="rules.content.length > 0">Nothing here</a>
				<a class="list-group-item" ng-repeat='rule in rules.content | orderBy:"points":true' ng-click='ruleCollapse(rule)' ng-class="{'list-group-item-info': rule.active}">
					<span class="badge" ng-class="{'badge-success': rule.points > 0, 'badge-danger': rule.points < 0}">{{rule.points}}</span><span class="glyphicon glyphicon-trash margin-right-5" ng-click="removeRule(rule.msg);$event.stopPropagation()" ></span><span class="pointer">{{rule.msg}}</span>
					
					<div class="list" ng-show="rule.active">
						<h4 class="margin-left-5">Apply for: </h4>
						<p class="margin-left-15 bold" href="" ng-repeat="user in changeKarma | orderBy:user">{{user.name}}
						<span class="glyphicon glyphicon-remove pointer ex-user" ng-click="selDeSelUserForKarmaChange(user.name, user.id); $event.stopPropagation()"></span>
						</p>
					</div>
					<div class="btn-holder margin-top" role="group" ng-show="rule.active">
						<button class="btn" ng-class="{'btn-success': changeKarma.length > 0, 'btn-danger disabled' : changeKarma.length == 0}" ng-click="changeUserKarma(changeKarma, rule); $event.stopPropagation()">{{changeKarma.length > 0 ? 'Apply this rule' : 'Click users first' }}</button>
						<button class="btn btn-warning pull-right" ng-click="clearTmp(); $event.stopPropagation()">Cancel</button>
						<input class="form-control margin-top" ng-model="rule.note" placeholder="add some note here">
					</div>
				</a>
				<li class="list-group-item" ng-if="role=='admin' && newRuleFlag">
					<form ng-submit="addRule()">
					<div class="input-group">
							<span class="input-group-addon">Txt:</span>
							<input class="form-control" type="text" ng-model="newRule.text" placeholder="Enter goal text" ng-required="true">
					</div>
					<div class="input-group margin-top">
						<span class="input-group-addon">Pts:</span>
						<input class="form-control" type="number" ng-model="newRule.points" placeholder="0" ng-required="true">
					</div>
						<button class="btn btn-success form-control margin-top" type="submit">Create</button>
					</form>
					<button class="btn btn-warning form-control margin-top" ng-click="newRuleTogle()" type = "reset">Cancel</button>
				</li>
				<a class="list-group-item">
					<button class="btn btn-primary form-control margin-top" type="button" ng-click="newRuleFlag = true" ng-hide="newRuleFlag">Add new global goal</button>
				</a>
			</div> -->
		</div>
	</div>

 

</div>